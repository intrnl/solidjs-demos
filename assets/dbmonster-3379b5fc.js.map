{"version":3,"file":"dbmonster-3379b5fc.js","sources":["../../src/dbmonster/env.js","../../src/dbmonster/app.jsx"],"sourcesContent":["var ENV =\n\tENV ||\n\t(function () {\n\t\t'use strict';\n\n\t\tvar first = true;\n\t\tvar counter = 0;\n\t\tvar data;\n\t\tvar _base;\n\t\t(_base = String.prototype).lpad ||\n\t\t\t(_base.lpad = function (padding, toLength) {\n\t\t\t\treturn padding.repeat((toLength - this.length) / padding.length).concat(this);\n\t\t\t});\n\n\t\tfunction formatElapsed(value) {\n\t\t\tvar comps;\n\n\t\t\tif (value > 60) {\n\t\t\t\tcomps = (value % 60).toFixed(2).split('.');\n\n\t\t\t\treturn Math.floor(value / 60) + ':' + comps[0].lpad('0', 2) + '.' + comps[1];\n\t\t\t}\n\n\t\t\treturn parseFloat(value).toFixed(2);\n\t\t}\n\n\t\tfunction getElapsedClassName(elapsed) {\n\t\t\tvar className = 'Query elapsed';\n\t\t\tif (elapsed >= 10.0) {\n\t\t\t\tclassName += ' warn_long';\n\t\t\t} else if (elapsed >= 1.0) {\n\t\t\t\tclassName += ' warn';\n\t\t\t} else {\n\t\t\t\tclassName += ' short';\n\t\t\t}\n\t\t\treturn className;\n\t\t}\n\n\t\tfunction countClassName(queries) {\n\t\t\tvar countClassName = 'label';\n\t\t\tif (queries >= 20) {\n\t\t\t\tcountClassName += ' label-important';\n\t\t\t} else if (queries >= 10) {\n\t\t\t\tcountClassName += ' label-warning';\n\t\t\t} else {\n\t\t\t\tcountClassName += ' label-success';\n\t\t\t}\n\t\t\treturn countClassName;\n\t\t}\n\n\t\tfunction updateQuery(object) {\n\t\t\tif (!object) {\n\t\t\t\tobject = {};\n\t\t\t}\n\t\t\tvar elapsed = Math.random() * 15;\n\t\t\tobject.elapsed = elapsed;\n\t\t\tobject.formatElapsed = formatElapsed(elapsed);\n\t\t\tobject.elapsedClassName = getElapsedClassName(elapsed);\n\t\t\tobject.query = 'SELECT blah FROM something';\n\t\t\tobject.waiting = Math.random() < 0.5;\n\t\t\tif (Math.random() < 0.2) {\n\t\t\t\tobject.query = '<IDLE> in transaction';\n\t\t\t}\n\t\t\tif (Math.random() < 0.1) {\n\t\t\t\tobject.query = 'vacuum';\n\t\t\t}\n\t\t\treturn object;\n\t\t}\n\n\t\tfunction cleanQuery(value) {\n\t\t\tif (value) {\n\t\t\t\tvalue.formatElapsed = '';\n\t\t\t\tvalue.elapsedClassName = '';\n\t\t\t\tvalue.query = '';\n\t\t\t\tvalue.elapsed = null;\n\t\t\t\tvalue.waiting = null;\n\t\t\t} else {\n\t\t\t\treturn {\n\t\t\t\t\tquery: '***',\n\t\t\t\t\tformatElapsed: '',\n\t\t\t\t\telapsedClassName: '',\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tfunction generateRow(object, keepIdentity, counter) {\n\t\t\tvar nbQueries = Math.floor(Math.random() * 10 + 1);\n\t\t\tif (!object) {\n\t\t\t\tobject = {};\n\t\t\t}\n\t\t\tobject.lastMutationId = counter;\n\t\t\tobject.nbQueries = nbQueries;\n\t\t\tif (!object.lastSample) {\n\t\t\t\tobject.lastSample = {};\n\t\t\t}\n\t\t\tif (!object.lastSample.topFiveQueries) {\n\t\t\t\tobject.lastSample.topFiveQueries = [];\n\t\t\t}\n\t\t\tif (keepIdentity) {\n\t\t\t\t// for Angular optimization\n\t\t\t\tif (!object.lastSample.queries) {\n\t\t\t\t\tobject.lastSample.queries = [];\n\t\t\t\t\tfor (var l = 0; l < 12; l++) {\n\t\t\t\t\t\tobject.lastSample.queries[l] = cleanQuery();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (var j in object.lastSample.queries) {\n\t\t\t\t\tvar value = object.lastSample.queries[j];\n\t\t\t\t\tif (j <= nbQueries) {\n\t\t\t\t\t\tupdateQuery(value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcleanQuery(value);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tobject.lastSample.queries = [];\n\t\t\t\tfor (var j = 0; j < 12; j++) {\n\t\t\t\t\tif (j < nbQueries) {\n\t\t\t\t\t\tvar value = updateQuery(cleanQuery());\n\t\t\t\t\t\tobject.lastSample.queries.push(value);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tobject.lastSample.queries.push(cleanQuery());\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfor (var i = 0; i < 5; i++) {\n\t\t\t\tvar source = object.lastSample.queries[i];\n\t\t\t\tobject.lastSample.topFiveQueries[i] = source;\n\t\t\t}\n\t\t\tobject.lastSample.nbQueries = nbQueries;\n\t\t\tobject.lastSample.countClassName = countClassName(nbQueries);\n\t\t\treturn object;\n\t\t}\n\n\t\tfunction getData(keepIdentity) {\n\t\t\tvar oldData = data;\n\t\t\tif (!keepIdentity) {\n\t\t\t\t// reset for each tick when !keepIdentity\n\t\t\t\tdata = [];\n\t\t\t\tfor (var i = 1; i <= ENV.rows; i++) {\n\t\t\t\t\tdata.push({ dbname: 'cluster' + i, query: '', formatElapsed: '', elapsedClassName: '' });\n\t\t\t\t\tdata.push({\n\t\t\t\t\t\tdbname: 'cluster' + i + ' replica',\n\t\t\t\t\t\tquery: '',\n\t\t\t\t\t\tformatElapsed: '',\n\t\t\t\t\t\telapsedClassName: '',\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!data) {\n\t\t\t\t// first init when keepIdentity\n\t\t\t\tdata = [];\n\t\t\t\tfor (var i = 1; i <= ENV.rows; i++) {\n\t\t\t\t\tdata.push({ dbname: 'cluster' + i });\n\t\t\t\t\tdata.push({ dbname: 'cluster' + i + ' replica' });\n\t\t\t\t}\n\t\t\t\toldData = data;\n\t\t\t}\n\t\t\tfor (var i in data) {\n\t\t\t\tvar row = data[i];\n\t\t\t\tif (!keepIdentity && oldData && oldData[i]) {\n\t\t\t\t\trow.lastSample = oldData[i].lastSample;\n\t\t\t\t}\n\t\t\t\tif (!row.lastSample || Math.random() < ENV.mutations()) {\n\t\t\t\t\tcounter = counter + 1;\n\t\t\t\t\tif (!keepIdentity) {\n\t\t\t\t\t\trow.lastSample = null;\n\t\t\t\t\t}\n\t\t\t\t\tgenerateRow(row, keepIdentity, counter);\n\t\t\t\t} else {\n\t\t\t\t\tdata[i] = oldData[i];\n\t\t\t\t}\n\t\t\t}\n\t\t\tfirst = false;\n\t\t\treturn {\n\t\t\t\ttoArray: function () {\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tvar mutationsValue = 0.5;\n\n\t\tfunction mutations(value) {\n\t\t\tif (value) {\n\t\t\t\tmutationsValue = value;\n\t\t\t\treturn mutationsValue;\n\t\t\t} else {\n\t\t\t\treturn mutationsValue;\n\t\t\t}\n\t\t}\n\n\t\tvar body = document.querySelector('body');\n\t\tvar theFirstChild = body.firstChild;\n\n\t\tvar sliderContainer = document.createElement('div');\n\t\tsliderContainer.style.cssText = 'display: flex';\n\t\tvar slider = document.createElement('input');\n\t\tvar text = document.createElement('label');\n\t\ttext.innerHTML = 'mutations : ' + (mutationsValue * 100).toFixed(0) + '%';\n\t\ttext.id = 'ratioval';\n\t\tslider.setAttribute('type', 'range');\n\t\tslider.style.cssText = 'margin-bottom: 10px; margin-top: 5px';\n\t\tslider.addEventListener('change', function (e) {\n\t\t\tENV.mutations(e.target.value / 100);\n\t\t\tdocument.querySelector('#ratioval').innerHTML =\n\t\t\t\t'mutations : ' + (ENV.mutations() * 100).toFixed(0) + '%';\n\t\t});\n\t\tsliderContainer.appendChild(text);\n\t\tsliderContainer.appendChild(slider);\n\t\tbody.insertBefore(sliderContainer, theFirstChild);\n\n\t\treturn {\n\t\t\tgenerateData: getData,\n\t\t\trows: 50,\n\t\t\ttimeout: 0,\n\t\t\tmutations: mutations,\n\t\t};\n\t})();\n\nwindow.ENV = ENV;\n","import { Index, render } from 'solid-js/web';\n\nimport * as perfmon from 'perf-monitor';\n\nimport './style.css';\nimport './env.js';\nimport { createSignal } from 'solid-js';\n\nfunction Table(props) {\n\treturn (\n\t\t<table class=\"table table-striped latest-data\">\n\t\t\t<tbody>\n\t\t\t\t<Index each={props.dbs}>\n\t\t\t\t\t{(db) => (\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<td class=\"dbname\">{db().dbname}</td>\n\n\t\t\t\t\t\t\t<td class=\"query-count\">\n\t\t\t\t\t\t\t\t<span class={db().lastSample.countClassName}>{db().lastSample.nbQueries}</span>\n\t\t\t\t\t\t\t</td>\n\n\t\t\t\t\t\t\t<Index each={db().lastSample.topFiveQueries}>\n\t\t\t\t\t\t\t\t{(query) => (\n\t\t\t\t\t\t\t\t\t<td class={query().elapsedClassName}>\n\t\t\t\t\t\t\t\t\t\t{query().formatElapsed}\n\n\t\t\t\t\t\t\t\t\t\t<div class=\"popover left\">\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"popover-content\">{query().query}</div>\n\t\t\t\t\t\t\t\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</Index>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t)}\n\t\t\t\t</Index>\n\t\t\t</tbody>\n\t\t</table>\n\t);\n}\n\nif (!/[&?]perfmon=(false|off|0)\\b/.test(location.search)) {\n\tperfmon.startFPSMonitor();\n\tperfmon.startMemMonitor();\n\tperfmon.initProfiler('view update');\n\n\tconst root = document.getElementById('root');\n\tconst [array, setArray] = createSignal([]);\n\n\tfunction redraw() {\n\t\tconst next = ENV.generateData().toArray();\n\n\t\tperfmon.startProfile('view update');\n\t\tsetArray(next);\n\t\tperfmon.endProfile('view update');\n\n\t\tsetTimeout(redraw, ENV.timeout);\n\t}\n\n\tredraw();\n\trender(() => <Table dbs={array()} />, root);\n} else {\n\tconst root = document.getElementById('root');\n\tconst [array, setArray] = createSignal([]);\n\n\tfunction redraw() {\n\t\tconst next = ENV.generateData().toArray();\n\n\t\tsetArray(next);\n\n\t\tsetTimeout(redraw, ENV.timeout);\n\t}\n\n\tredraw();\n\trender(() => <Table dbs={array()} />, root);\n}\n"],"names":["ENV","data","_base","counter","updateQuery","object","value","comps","elapsed","Math","random","formatElapsed","toFixed","split","floor","lpad","parseFloat","elapsedClassName","className","getElapsedClassName","query","waiting","cleanQuery","generateRow","keepIdentity","nbQueries","lastMutationId","lastSample","topFiveQueries","queries","l","j","push","i","source","countClassName","String","prototype","padding","toLength","repeat","this","length","concat","mutationsValue","body","document","querySelector","theFirstChild","firstChild","sliderContainer","createElement","style","cssText","slider","text","innerHTML","id","setAttribute","addEventListener","e","mutations","target","appendChild","insertBefore","generateData","oldData","rows","dbname","row","toArray","timeout","window","Table","props","_el$","_tmpl$","_el$2","_$insert","_$createComponent","Index","each","dbs","children","db","_el$3","_tmpl$2","_el$4","_el$6","nextSibling","_el$7","_tmpl$3","_el$8","_el$9","_$effect","_$className","test","location","search","root","getElementById","array","setArray","createSignal","redraw","next","setTimeout","render","perfmon"],"mappings":"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"}